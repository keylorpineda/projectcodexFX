<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.layout.ColumnConstraints?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.municipal.reservationsfx.ui.controllers.DashboardOverviewController"
      spacing="24"
      styleClass="main-content"
      fillWidth="true">

    <padding>
        <Insets top="24" right="32" bottom="32" left="32"/>
    </padding>

    <!-- Page Header -->
    <HBox alignment="CENTER_LEFT" spacing="0">
        <VBox spacing="4" HBox.hgrow="ALWAYS">
            <Label fx:id="pageTitle" text="Panel de Administración" styleClass="page-title"/>
            <Label fx:id="pageSubtitle" text="Resumen general del sistema de reservas" styleClass="page-subtitle"/>
        </VBox>

        <Button fx:id="refreshButton" text="Actualizar datos" styleClass="refresh-button">
            <graphic>
                <Label text="🔄" styleClass="button-icon"/>
            </graphic>
        </Button>
    </HBox>

    <!-- Metrics Grid -->
    <VBox spacing="16" styleClass="metrics-container" fillWidth="true">
        <HBox spacing="16" fillHeight="false">
            <VBox styleClass="metric-card, metric-success" spacing="8" HBox.hgrow="ALWAYS" minWidth="200">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                <Label text="Espacios Activos" styleClass="metric-label"/>
                <Label fx:id="activeSpacesLabel" text="0" styleClass="metric-value"/>
                <Label text="Espacios disponibles para reserva" styleClass="metric-description" wrapText="true"/>
            </VBox>

            <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS" minWidth="200">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                <Label text="Reservas Hoy" styleClass="metric-label"/>
                <Label fx:id="todayReservationsLabel" text="0" styleClass="metric-value"/>
                <Label text="Reservas programadas para hoy" styleClass="metric-description" wrapText="true"/>
            </VBox>
        </HBox>

        <HBox spacing="16" fillHeight="false">
            <VBox styleClass="metric-card, metric-destructive" spacing="8" HBox.hgrow="ALWAYS" minWidth="200">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                <Label text="Inasistencias" styleClass="metric-label"/>
                <Label fx:id="missedLabel" text="0" styleClass="metric-value"/>
                <Label text="Total de inasistencias registradas" styleClass="metric-description" wrapText="true"/>
            </VBox>

            <VBox styleClass="metric-card, metric-success" spacing="8" HBox.hgrow="ALWAYS" minWidth="200">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                <Label text="Ocupación Semanal" styleClass="metric-label"/>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Label fx:id="weeklyOccupancyLabel" text="0%" styleClass="metric-value"/>
                    <Label fx:id="weeklyTrendLabel" text="" styleClass="metric-trend"/>
                </HBox>
                <Label text="Promedio de ocupación" styleClass="metric-description" wrapText="true"/>
            </VBox>
        </HBox>
    </VBox>

    <!-- Weather and Alerts Section -->
    <HBox spacing="24" fillHeight="false">
        <!-- Weather Widget -->
        <VBox styleClass="card, weather-card" spacing="16" prefWidth="360" HBox.hgrow="NEVER">
            <padding>
                <Insets top="24" right="24" bottom="24" left="24"/>
            </padding>

            <HBox spacing="12" alignment="CENTER_LEFT">
                <Label text="Clima actual" styleClass="card-title"/>
                <Label fx:id="weatherUpdatedLabel" text="Actualizado" styleClass="weather-badge"/>
            </HBox>

            <HBox spacing="24" alignment="CENTER_LEFT">
                <VBox spacing="8">
                    <Label fx:id="weatherTempLabel" text="-" styleClass="weather-temp"/>
                    <Label fx:id="weatherConditionLabel" text="-" styleClass="weather-condition"/>
                    <Label fx:id="weatherWindLabel" text="-" styleClass="weather-detail"/>
                    <Label fx:id="weatherRainLabel" text="-" styleClass="weather-detail"/>
                </VBox>
                <StackPane styleClass="weather-icon-container" minWidth="100" minHeight="100">
                    <Label fx:id="weatherIconLabel" text="☀️" styleClass="weather-icon-large"/>
                </StackPane>
            </HBox>

            <VBox fx:id="weatherMessageBox" styleClass="weather-message-success">
                <padding>
                    <Insets top="12" right="12" bottom="12" left="12"/>
                </padding>
                <Label fx:id="weatherMessageLabel" text="" styleClass="weather-message" wrapText="true"/>
            </VBox>
        </VBox>

        <!-- Quick Alerts Panel -->
        <VBox styleClass="card" spacing="16" HBox.hgrow="ALWAYS">
            <padding>
                <Insets top="24" right="24" bottom="24" left="24"/>
            </padding>

            <HBox spacing="12" alignment="CENTER_LEFT">
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Alertas Rápidas" styleClass="card-title"/>
                    <Label text="Notificaciones que requieren atención" styleClass="card-subtitle"/>
                </VBox>
                <Label fx:id="alertCountBadge" text="0" styleClass="alert-count-badge"/>
            </HBox>

            <ListView fx:id="alertsList" styleClass="alerts-list" VBox.vgrow="ALWAYS"/>
        </VBox>
    </HBox>

    <!-- Quick Actions -->
    <VBox styleClass="card" spacing="16" fillWidth="true">
        <padding>
            <Insets top="24" right="24" bottom="24" left="24"/>
        </padding>

        <VBox spacing="4">
            <Label text="Acciones Rápidas" styleClass="card-title"/>
            <Label text="Accesos directos a funciones principales" styleClass="card-subtitle"/>
        </VBox>

        <VBox spacing="12" fillWidth="true">
            <HBox spacing="12" fillHeight="false">
                <Button fx:id="manageSpacesButton"
                        text="Gestionar Espacios"
                        styleClass="action-button"
                        maxWidth="Infinity"
                        onAction="#handleManageSpaces"
                        HBox.hgrow="ALWAYS">
                    <graphic>
                        <Label text="🏢" styleClass="action-icon"/>
                    </graphic>
                </Button>

                <Button fx:id="viewUsersButton"
                        text="Ver Usuarios"
                        styleClass="action-button"
                        maxWidth="Infinity"
                        onAction="#handleViewUsers"
                        HBox.hgrow="ALWAYS">
                    <graphic>
                        <Label text="👥" styleClass="action-icon"/>
                    </graphic>
                </Button>
            </HBox>

            <HBox spacing="12" fillHeight="false">
                <Button fx:id="controlReservationsButton"
                        text="Control de Reservas"
                        styleClass="action-button"
                        maxWidth="Infinity"
                        onAction="#handleControlReservations"
                        HBox.hgrow="ALWAYS">
                    <graphic>
                        <Label text="📅" styleClass="action-icon"/>
                    </graphic>
                </Button>

                <Button fx:id="climateMonitoringButton"
                        text="Monitoreo Climático"
                        styleClass="action-button"
                        maxWidth="Infinity"
                        onAction="#handleClimateMonitoring"
                        HBox.hgrow="ALWAYS">
                    <graphic>
                        <Label text="☁️" styleClass="action-icon"/>
                    </graphic>
                </Button>
            </HBox>
        </VBox>
    </VBox>

    <!-- Featured Spaces -->
    <VBox styleClass="card" spacing="18" fillWidth="true">
        <padding>
            <Insets top="24" right="24" bottom="24" left="24"/>
        </padding>

        <HBox alignment="CENTER_LEFT" spacing="12">
            <Label text="Espacios destacados" styleClass="card-title"/>
            <Label text="Resumen de disponibilidad" styleClass="card-subtitle"/>
        </HBox>

        <FlowPane fx:id="spacesFlow" hgap="16" vgap="16" prefWrapLength="880"/>
    </VBox>

    <!-- Latest Reservations -->
    <VBox styleClass="card" spacing="18" fillWidth="true">
        <padding>
            <Insets top="24" right="24" bottom="24" left="24"/>
        </padding>

        <HBox alignment="CENTER_LEFT" spacing="12">
            <Label text="Reservas recientes" styleClass="card-title"/>
            <Label text="Seguimiento de confirmaciones" styleClass="card-subtitle"/>
        </HBox>

        <GridPane fx:id="reservationsGrid" hgap="8" vgap="8">
            <columnConstraints>
                <ColumnConstraints percentWidth="18"/>
                <ColumnConstraints percentWidth="20"/>
                <ColumnConstraints percentWidth="15"/>
                <ColumnConstraints percentWidth="15"/>
                <ColumnConstraints percentWidth="12"/>
                <ColumnConstraints percentWidth="10"/>
                <ColumnConstraints percentWidth="10"/>
            </columnConstraints>
            <children>
                <Label text="Usuario" styleClass="table-header" GridPane.columnIndex="0"/>
                <Label text="Espacio" styleClass="table-header" GridPane.columnIndex="1"/>
                <Label text="Fecha" styleClass="table-header" GridPane.columnIndex="2"/>
                <Label text="Hora" styleClass="table-header" GridPane.columnIndex="3"/>
                <Label text="Estado" styleClass="table-header" GridPane.columnIndex="4"/>
                <Label text="QR" styleClass="table-header" GridPane.columnIndex="5"/>
                <Label text="Clima" styleClass="table-header" GridPane.columnIndex="6"/>
            </children>
        </GridPane>
    </VBox>
</VBox>
