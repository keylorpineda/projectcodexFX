<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.Cursor?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:id="mainContainer"
      fx:controller="com.municipal.ui.controllers.SupervisorDashboardController"
      stylesheets="@../styles/supervisor-dashboard.css"
      styleClass="supervisor-root"
      spacing="0">

    <!-- Top Header -->
    <HBox styleClass="supervisor-header" alignment="CENTER_LEFT" spacing="0" VBox.vgrow="NEVER">
        <padding>
            <Insets top="16" right="24" bottom="16" left="24"/>
        </padding>

        <!-- Logo Section -->
        <HBox alignment="CENTER_LEFT" spacing="12" HBox.hgrow="ALWAYS">
            <StackPane styleClass="logo-container" minWidth="48" minHeight="48">
                <ImageView fitHeight="48" fitWidth="48" preserveRatio="true">
                    <image>
                        <Image url="@../../../../images/EscudoMunicipalidadPérezZeledon.png" />
                    </image>
                </ImageView>
            </StackPane>
            <VBox spacing="2">
                <Label text="Sistema de Reservas" styleClass="header-title"/>
                <Label text="Municipalidad de Pérez Zeledón" styleClass="header-subtitle"/>
            </VBox>
        </HBox>

        <!-- Spacer -->
        <Region HBox.hgrow="ALWAYS"/>

        <!-- User Menu -->
        <HBox fx:id="userMenuContainer" styleClass="user-menu" spacing="8" alignment="CENTER">
            <Circle radius="16" styleClass="user-avatar"/>
            <VBox spacing="0">
                <Label fx:id="supervisorNameLabel" text="Supervisor" styleClass="user-name"/>
                <Label fx:id="supervisorEmailLabel" text="supervisor@mail.com" styleClass="user-role"/>
            </VBox>
        </HBox>
    </HBox>

    <!-- Main Content Area -->
    <HBox spacing="0" VBox.vgrow="ALWAYS">

        <!-- Left Sidebar -->
        <VBox styleClass="sidebar" spacing="8" prefWidth="260" minWidth="240" HBox.hgrow="NEVER">
            <padding>
                <Insets top="16" right="0" bottom="16" left="0"/>
            </padding>

            <Label text="MENÚ PRINCIPAL" styleClass="sidebar-section-title">
                <padding>
                    <Insets top="0" right="20" bottom="0" left="20"/>
                </padding>
            </Label>

            <HBox fx:id="navDashboardButton" styleClass="nav-item active" onMouseClicked="#showDashboard" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="📊" styleClass="nav-icon"/>
                <Label text="Panel de inicio"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <HBox fx:id="navScanQRButton" styleClass="nav-item" onMouseClicked="#showScanQR" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="📱" styleClass="nav-icon"/>
                <Label text="Escanear QR"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <HBox fx:id="navControlButton" styleClass="nav-item" onMouseClicked="#showControl" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="✅" styleClass="nav-icon"/>
                <Label text="Control de Ingresos"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <HBox fx:id="navSearchButton" styleClass="nav-item" onMouseClicked="#showSearch" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="🔍" styleClass="nav-icon"/>
                <Label text="Buscar Eventos"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <Region VBox.vgrow="ALWAYS"/>

            <Separator/>

            <HBox styleClass="logout-item" onMouseClicked="#handleLogout" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="⎋" styleClass="nav-icon"/>
                <Label text="Cerrar Sesión"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>
        </VBox>

        <!-- Main Content -->
        <StackPane styleClass="content-area" HBox.hgrow="ALWAYS">
            
            <!-- SECCIÓN 1: DASHBOARD -->
            <VBox fx:id="dashboardSection" styleClass="content-section" spacing="24" visible="true">
                <padding>
                    <Insets top="32" right="40" bottom="32" left="40"/>
                </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Panel de Supervisor" styleClass="section-header"/>
                        <Label text="Vista general de eventos y métricas de asistencia" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Cards de métricas -->
                    <HBox spacing="20" alignment="CENTER_LEFT">
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="🎯 Eventos Activos" styleClass="metric-label"/>
                            <Label fx:id="activeEventsLabel" text="0" styleClass="metric-value"/>
                            <Label text="En progreso ahora" styleClass="metric-subtitle"/>
                        </VBox>
                        
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="✅ Check-ins Hoy" styleClass="metric-label"/>
                            <Label fx:id="todayCheckInsLabel" text="0" styleClass="metric-value"/>
                            <Label text="Asistencias registradas" styleClass="metric-subtitle"/>
                        </VBox>
                        
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="⏰ Pendientes" styleClass="metric-label"/>
                            <Label fx:id="pendingReservationsLabel" text="0" styleClass="metric-value"/>
                            <Label text="Por confirmar entrada" styleClass="metric-subtitle"/>
                        </VBox>
                    </HBox>
                    
                    <!-- Eventos en progreso -->
                    <VBox spacing="16">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label text="Eventos en Progreso" styleClass="subsection-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="refreshDashboardButton" text="🔄 Actualizar" styleClass="ghost-button"
                                    onAction="#refreshDashboard">
                                <cursor><Cursor fx:constant="HAND"/></cursor>
                            </Button>
                        </HBox>
                        
                        <FlowPane fx:id="inProgressEventsPane" styleClass="events-flow" hgap="20" vgap="20">
                            <padding>
                                <Insets top="10" right="10" bottom="10" left="10"/>
                            </padding>
                        </FlowPane>
                    </VBox>
                </VBox>
                
                <!-- SECCIÓN 2: ESCANEAR QR -->
                <VBox fx:id="scanQRSection" styleClass="content-section" spacing="24" visible="false">
                    <padding>
                        <Insets top="32" right="40" bottom="32" left="40"/>
                    </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Escanear Código QR" styleClass="section-header"/>
                        <Label text="Valida el código QR de una reserva para registrar el ingreso" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Área de escaneo -->
                    <VBox styleClass="scan-container" spacing="20" alignment="CENTER">
                        <padding>
                            <Insets top="40" right="40" bottom="40" left="40"/>
                        </padding>
                        
                        <Label text="📱" styleClass="scan-icon"/>
                        
                        <VBox spacing="12" alignment="CENTER">
                            <Label text="Escanear Código QR con Cámara" styleClass="scan-title"/>
                            <Label text="Active la cámara para escanear automáticamente el código QR" styleClass="scan-subtitle"/>
                        </VBox>
                        
                        <!-- Vista previa de la cámara -->
                        <StackPane fx:id="cameraPreviewContainer" styleClass="camera-preview" visible="false">
                            <ImageView fx:id="cameraImageView" fitWidth="500" fitHeight="375" preserveRatio="true"/>
                            <Label fx:id="scanningLabel" text="🔍 Buscando código QR..." styleClass="scanning-overlay" 
                                   StackPane.alignment="BOTTOM_CENTER">
                                <StackPane.margin>
                                    <Insets bottom="20"/>
                                </StackPane.margin>
                            </Label>
                        </StackPane>
                        
                        <!-- Botones de control de cámara -->
                        <HBox spacing="12" alignment="CENTER">
                            <Button fx:id="startCameraButton" text="📷 Activar Cámara" styleClass="primary-button-large"
                                    onAction="#handleStartCamera" prefWidth="250">
                                <cursor><Cursor fx:constant="HAND"/></cursor>
                            </Button>
                            <Button fx:id="stopCameraButton" text="⏹ Detener Cámara" styleClass="accent-button"
                                    onAction="#handleStopCamera" prefWidth="250" visible="false">
                                <cursor><Cursor fx:constant="HAND"/></cursor>
                            </Button>
                        </HBox>
                        
                        <Label text="── O ingrese manualmente ──" styleClass="divider-text"/>
                        
                        <TextField fx:id="qrCodeField" promptText="Ingrese el código QR (ej: RES-123-456-...)" 
                                   styleClass="qr-input" prefWidth="500" maxWidth="500">
                        </TextField>
                        
                        <Button fx:id="scanButton" text="✅ Validar Código" styleClass="ghost-button"
                                onAction="#handleScanQR" prefWidth="300">
                            <cursor><Cursor fx:constant="HAND"/></cursor>
                        </Button>
                        
                        <!-- Mensaje de validación -->
                        <VBox fx:id="validationMessageBox" spacing="8" alignment="CENTER" visible="false">
                            <Label fx:id="validationMessageLabel" wrapText="true" textAlignment="CENTER"
                                   styleClass="validation-message" maxWidth="500"/>
                        </VBox>
                    </VBox>
                </VBox>
                
                <!-- SECCIÓN 3: CONTROL DE INGRESOS -->
                <VBox fx:id="controlSection" styleClass="content-section" spacing="24" visible="false">
                    <padding>
                        <Insets top="32" right="40" bottom="32" left="40"/>
                    </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Control de Ingresos" styleClass="section-header"/>
                        <Label text="Monitorea las asistencias en tiempo real" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Selector de reserva -->
                    <HBox spacing="16" alignment="CENTER_LEFT">
                        <Label text="Seleccionar Evento:" styleClass="control-label"/>
                        <ComboBox fx:id="reservationComboBox" promptText="Seleccione una reserva activa"
                                  styleClass="reservation-combo" prefWidth="400" HBox.hgrow="ALWAYS"
                                  onAction="#handleReservationSelected"/>
                        <Button fx:id="refreshControlButton" text="🔄 Actualizar" styleClass="ghost-button"
                                onAction="#refreshControl">
                            <cursor><Cursor fx:constant="HAND"/></cursor>
                        </Button>
                    </HBox>
                    
                    <!-- Panel de información de la reserva -->
                    <VBox fx:id="reservationInfoBox" styleClass="info-box" spacing="12" visible="false">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <HBox spacing="20" alignment="CENTER_LEFT">
                            <VBox spacing="4" HBox.hgrow="ALWAYS">
                                <Label fx:id="reservationTitleLabel" text="Título de la Reserva" styleClass="info-title"/>
                                <Label fx:id="reservationDetailsLabel" text="Detalles" styleClass="info-details"/>
                            </VBox>
                            
                            <VBox spacing="4" alignment="CENTER_RIGHT">
                                <Label text="Capacidad" styleClass="capacity-label"/>
                                <Label fx:id="capacityLabel" text="0 / 0" styleClass="capacity-value"/>
                            </VBox>
                        </HBox>
                        
                        <!-- Barra de progreso de capacidad -->
                        <ProgressBar fx:id="capacityProgressBar" progress="0.0" styleClass="capacity-progress"
                                     prefWidth="Infinity" minHeight="12"/>
                    </VBox>
                    
                    <!-- Lista de asistentes -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS">
                        <Label text="Lista de Asistentes" styleClass="subsection-title"/>
                        
                        <ListView fx:id="attendeesListView" styleClass="attendees-list" prefHeight="400"/>
                    </VBox>
                </VBox>
                
                <!-- SECCIÓN 4: BUSCAR EVENTOS -->
                <VBox fx:id="searchSection" styleClass="content-section" spacing="24" visible="false">
                    <padding>
                        <Insets top="32" right="40" bottom="32" left="40"/>
                    </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Buscar Eventos" styleClass="section-header"/>
                        <Label text="Encuentra reservas por espacio, fecha o estado" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Filtros de búsqueda -->
                    <HBox spacing="16" alignment="CENTER_LEFT">
                        <TextField fx:id="searchField" promptText="Buscar por nombre de espacio..." 
                                   styleClass="search-input" HBox.hgrow="ALWAYS"/>
                        
                        <ComboBox fx:id="statusFilterCombo" promptText="Estado" styleClass="filter-combo"
                                  prefWidth="180"/>
                        
                        <DatePicker fx:id="dateFilterPicker" promptText="Fecha" styleClass="date-picker"
                                    prefWidth="160"/>
                        
                        <Button fx:id="searchButton" text="🔍 Buscar" styleClass="primary-button"
                                onAction="#handleSearch">
                            <cursor><Cursor fx:constant="HAND"/></cursor>
                        </Button>
                        
                        <Button fx:id="clearSearchButton" text="Limpiar" styleClass="ghost-button"
                                onAction="#handleClearSearch">
                            <cursor><Cursor fx:constant="HAND"/></cursor>
                        </Button>
                    </HBox>
                    
                    <!-- Resultados de búsqueda -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS">
                        <Label text="Resultados" styleClass="subsection-title"/>
                        
                        <FlowPane fx:id="searchResultsPane" styleClass="search-results-flow" hgap="20" vgap="20">
                            <padding>
                                <Insets top="10" right="10" bottom="10" left="10"/>
                            </padding>
                        </FlowPane>
                    </VBox>
                </VBox>
                
        </StackPane>
    </HBox>
</VBox>
