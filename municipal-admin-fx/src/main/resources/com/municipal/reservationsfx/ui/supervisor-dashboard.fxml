<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.Cursor?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.municipal.ui.controllers.SupervisorDashboardController"
           stylesheets="@../styles/supervisor-dashboard.css"
           prefWidth="1400" prefHeight="900">

    <!-- Main Content -->
    <VBox fx:id="mainContainer" styleClass="supervisor-root" spacing="0" 
          StackPane.alignment="TOP_LEFT" maxWidth="Infinity" maxHeight="Infinity">

        <!-- Top Header -->
    <HBox styleClass="supervisor-header" alignment="CENTER_LEFT" spacing="0" VBox.vgrow="NEVER">
        <padding>
            <Insets top="16" right="24" bottom="16" left="24"/>
        </padding>

        <!-- Logo Section -->
        <HBox alignment="CENTER_LEFT" spacing="12" HBox.hgrow="ALWAYS">
            <StackPane styleClass="logo-container" minWidth="48" minHeight="48">
                <ImageView fitHeight="48" fitWidth="48" preserveRatio="true">
                    <image>
                        <Image url="@../../../../images/EscudoMunicipalidadPÃ©rezZeledon.png" />
                    </image>
                </ImageView>
            </StackPane>
            <VBox spacing="2">
                <Label text="Sistema de Reservas" styleClass="header-title"/>
                <Label text="Municipalidad de PÃ©rez ZeledÃ³n" styleClass="header-subtitle"/>
            </VBox>
        </HBox>

        <!-- Spacer -->
        <Region HBox.hgrow="ALWAYS"/>

        <!-- User Menu -->
        <HBox fx:id="userMenuContainer" styleClass="user-menu" spacing="8" alignment="CENTER">
            <Circle radius="16" styleClass="user-avatar"/>
            <VBox spacing="0">
                <Label fx:id="supervisorNameLabel" text="Supervisor" styleClass="user-name"/>
                <Label fx:id="supervisorEmailLabel" text="supervisor@mail.com" styleClass="user-role"/>
            </VBox>
        </HBox>
    </HBox>

    <!-- Main Content Area -->
    <HBox spacing="0" VBox.vgrow="ALWAYS">

        <!-- Left Sidebar -->
        <VBox styleClass="sidebar" spacing="8" prefWidth="260" minWidth="240" HBox.hgrow="NEVER">
            <padding>
                <Insets top="16" right="0" bottom="16" left="0"/>
            </padding>

            <Label text="MENÃš PRINCIPAL" styleClass="sidebar-section-title">
                <padding>
                    <Insets top="0" right="20" bottom="0" left="20"/>
                </padding>
            </Label>

            <HBox fx:id="navDashboardButton" styleClass="nav-item active" onMouseClicked="#showDashboard" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="ðŸ“Š" styleClass="nav-icon"/>
                <Label text="Panel de inicio"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <HBox fx:id="navScanQRButton" styleClass="nav-item" onMouseClicked="#showScanQR" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="ðŸ“±" styleClass="nav-icon"/>
                <Label text="Escanear QR"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <HBox fx:id="navControlButton" styleClass="nav-item" onMouseClicked="#showControl" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="ðŸŸï¸" styleClass="nav-icon"/>
                <Label text="Espacios en Uso"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>

            <Region VBox.vgrow="ALWAYS"/>

            <Separator/>

            <HBox styleClass="logout-item" onMouseClicked="#handleLogout" alignment="CENTER_LEFT" spacing="12">
                <padding>
                    <Insets top="12" right="20" bottom="12" left="20"/>
                </padding>
                <Label text="âŽ‹" styleClass="nav-icon"/>
                <Label text="Cerrar SesiÃ³n"/>
                <cursor><Cursor fx:constant="HAND"/></cursor>
            </HBox>
        </VBox>

        <!-- Main Content -->
        <StackPane styleClass="content-area" HBox.hgrow="ALWAYS">
            
            <!-- SECCIÃ“N 1: DASHBOARD -->
            <VBox fx:id="dashboardSection" styleClass="content-section" spacing="24" visible="true">
                <padding>
                    <Insets top="32" right="40" bottom="32" left="40"/>
                </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Panel de Supervisor" styleClass="section-header"/>
                        <Label text="Vista general de eventos y mÃ©tricas de asistencia" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Cards de mÃ©tricas -->
                    <HBox spacing="20" alignment="CENTER_LEFT">
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="ðŸŽ¯ Eventos Activos" styleClass="metric-label"/>
                            <Label fx:id="activeEventsLabel" text="0" styleClass="metric-value"/>
                            <Label text="En progreso ahora" styleClass="metric-subtitle"/>
                        </VBox>
                        
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="âœ… Check-ins Hoy" styleClass="metric-label"/>
                            <Label fx:id="todayCheckInsLabel" text="0" styleClass="metric-value"/>
                            <Label text="Asistencias registradas" styleClass="metric-subtitle"/>
                        </VBox>
                        
                        <VBox styleClass="metric-card" spacing="8" HBox.hgrow="ALWAYS">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="â° Pendientes" styleClass="metric-label"/>
                            <Label fx:id="pendingReservationsLabel" text="0" styleClass="metric-value"/>
                            <Label text="Por confirmar entrada" styleClass="metric-subtitle"/>
                        </VBox>
                    </HBox>
                    
                    <!-- Eventos en progreso -->
                    <VBox spacing="16">
                        <Label text="Eventos en Progreso" styleClass="subsection-title"/>
                        
                        <FlowPane fx:id="inProgressEventsPane" styleClass="events-flow" hgap="20" vgap="20">
                            <padding>
                                <Insets top="10" right="10" bottom="10" left="10"/>
                            </padding>
                        </FlowPane>
                    </VBox>
                </VBox>
                
                <!-- SECCIÃ“N 2: ESCANEAR QR -->
                <VBox fx:id="scanQRSection" styleClass="content-section" spacing="24" visible="false">
                    <padding>
                        <Insets top="32" right="40" bottom="32" left="40"/>
                    </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Escanear CÃ³digo QR" styleClass="section-header"/>
                        <Label text="Valida el cÃ³digo QR de una reserva para registrar el ingreso" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Ãrea de escaneo -->
                    <ScrollPane fitToWidth="true" styleClass="qr-scroll" VBox.vgrow="ALWAYS">
                    <VBox styleClass="scan-container" spacing="20" alignment="CENTER">
                        <padding>
                            <Insets top="40" right="40" bottom="40" left="40"/>
                        </padding>
                        
                        <Label text="ðŸ“±" styleClass="scan-icon"/>
                        
                        <VBox spacing="12" alignment="CENTER">
                            <Label text="Escanear CÃ³digo QR con CÃ¡mara" styleClass="scan-title"/>
                            <Label text="Active la cÃ¡mara para escanear automÃ¡ticamente el cÃ³digo QR" styleClass="scan-subtitle"/>
                        </VBox>
                        
                        <!-- Vista previa de la cÃ¡mara -->
                        <StackPane fx:id="cameraPreviewContainer" styleClass="camera-preview" visible="false">
                            <ImageView fx:id="cameraImageView" fitWidth="500" fitHeight="375" preserveRatio="true"/>
                            <Label fx:id="scanningLabel" text="ðŸ” Buscando cÃ³digo QR..." styleClass="scanning-overlay" 
                                   StackPane.alignment="BOTTOM_CENTER">
                                <StackPane.margin>
                                    <Insets bottom="20"/>
                                </StackPane.margin>
                            </Label>
                        </StackPane>
                        
                        <!-- Botones de control de cÃ¡mara -->
                        <HBox spacing="12" alignment="CENTER">
                            <Button fx:id="startCameraButton" text="ðŸ“· Activar CÃ¡mara" styleClass="primary-button-large"
                                    onAction="#handleStartCamera" prefWidth="250">
                                <cursor><Cursor fx:constant="HAND"/></cursor>
                            </Button>
                            <Button fx:id="stopCameraButton" text="â¹ Detener CÃ¡mara" styleClass="accent-button"
                                    onAction="#handleStopCamera" prefWidth="250" visible="false">
                                <cursor><Cursor fx:constant="HAND"/></cursor>
                            </Button>
                        </HBox>
                        
                        <Label text="â”€â”€ O ingrese manualmente â”€â”€" styleClass="divider-text"/>
                        
                        <TextField fx:id="qrCodeField" promptText="Ingrese el cÃ³digo QR (ej: RES-123-456-...)" 
                                   styleClass="qr-input" prefWidth="500" maxWidth="500">
                        </TextField>
                        
                        <Button fx:id="scanButton" text="âœ… Validar CÃ³digo" styleClass="ghost-button"
                                onAction="#handleScanQR" prefWidth="300">
                            <cursor><Cursor fx:constant="HAND"/></cursor>
                        </Button>
                        
                        <!-- Mensaje de validaciÃ³n -->
                        <VBox fx:id="validationMessageBox" spacing="8" alignment="CENTER" visible="false">
                            <Label fx:id="validationMessageLabel" wrapText="true" textAlignment="CENTER"
                                   styleClass="validation-message" maxWidth="500"/>
                        </VBox>
                    </VBox>
                    </ScrollPane>
                </VBox>
                
                <!-- SECCIÃ“N 3: ESPACIOS EN USO -->
                <VBox fx:id="controlSection" styleClass="content-section" spacing="24" visible="false">
                    <padding>
                        <Insets top="32" right="40" bottom="32" left="40"/>
                    </padding>
                    
                    <!-- Header -->
                    <VBox spacing="8">
                        <Label text="Espacios en Uso" styleClass="section-header"/>
                        <Label text="Espacios con actividades en curso en este momento" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Resumen -->
                    <VBox spacing="4">
                        <Label fx:id="spacesInUseCountLabel" text="0 espacios en uso" styleClass="control-label"/>
                        <Label fx:id="spacesInUseTimeLabel" text="Actualizado hace un momento" styleClass="timestamp-label"/>
                    </VBox>
                    
                    <!-- Grid de espacios en uso -->
                    <ScrollPane fitToWidth="true" styleClass="spaces-scroll" VBox.vgrow="ALWAYS">
                        <FlowPane fx:id="spacesInUsePane" styleClass="spaces-flow" hgap="24" vgap="24">
                            <padding>
                                <Insets top="16" right="16" bottom="16" left="16"/>
                            </padding>
                        </FlowPane>
                    </ScrollPane>
                </VBox>
                
        </StackPane>
    </HBox>
    </VBox>

    <!-- Panel de Perfil (Overlay) -->
    <StackPane fx:id="profilePanelOverlay" visible="false" managed="false" styleClass="overlay"
               mouseTransparent="false">
        <VBox fx:id="profilePanel" styleClass="profile-panel" spacing="12" 
              prefWidth="240" maxWidth="240" StackPane.alignment="TOP_RIGHT">
            <StackPane.margin>
                <Insets top="70" right="20" bottom="0" left="0"/>
            </StackPane.margin>
            <padding>
                <Insets top="16" right="16" bottom="16" left="16"/>
            </padding>
            
            <!-- User Info -->
            <VBox spacing="8" alignment="CENTER">
                <Circle radius="24" styleClass="profile-avatar"/>
                <Label fx:id="profileNameLabel" text="Supervisor" styleClass="profile-name"/>
                <Label fx:id="profileEmailLabel" text="supervisor@mail.com" styleClass="profile-email"/>
            </VBox>
            
            <Separator/>
            
            <!-- Menu Options -->
            <VBox spacing="8">
                <Button text="ðŸšª  Cerrar sesiÃ³n" styleClass="profile-menu-item-danger" 
                        onAction="#handleLogout" maxWidth="Infinity">
                    <cursor><Cursor fx:constant="HAND"/></cursor>
                </Button>
            </VBox>
        </VBox>
    </StackPane>

</StackPane>
