<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.shape.Circle?>

<BorderPane xmlns:fx="http://javafx.com/fxml/1"
            xmlns="http://javafx.com/javafx/17"
            fx:controller="com.municipal.ui.controllers.AdminDashboardController"
            stylesheets="@../styles/styles.css">
    
    <!-- HEADER -->
    <top>
        <StackPane fx:id="headerStack">
            <HBox styleClass="header" alignment="CENTER_LEFT" spacing="15">
                <padding>
                    <Insets top="15" right="20" bottom="15" left="20"/>
                </padding>

                <!-- Logo y título -->
                <HBox alignment="CENTER_LEFT" spacing="10" HBox.hgrow="ALWAYS">
                    <ImageView fitHeight="40" fitWidth="40" preserveRatio="true">
                        <image>
                            <Image url="@../images/microsoftlogo.png"/>
                        </image>
                    </ImageView>
                    <VBox>
                        <Label text="Panel de Administración" styleClass="header-title"/>
                        <Label text="Municipalidad de Pérez Zeledón" styleClass="header-subtitle"/>
                    </VBox>
                </HBox>

                <!-- Notificaciones y usuario -->
                <HBox alignment="CENTER_RIGHT" spacing="20">
                    <Button fx:id="btnNotificaciones" styleClass="icon-button">
                        <graphic>
                            <StackPane>
                                <Label text="🔔" styleClass="icon"/>
                                <Label fx:id="lblNotificacionesBadge" text="0" styleClass="badge"
                                       StackPane.alignment="TOP_RIGHT" visible="true"/>
                            </StackPane>
                        </graphic>
                    </Button>

                    <HBox fx:id="userProfileBox" alignment="CENTER" spacing="10" styleClass="user-profile">
                        <Circle radius="18" styleClass="avatar"/>
                        <Label fx:id="lblNombreUsuario" text="Usuario" styleClass="username"/>
                    </HBox>
                </HBox>
            </HBox>

            <VBox fx:id="panelNotificaciones" styleClass="notification-panel" spacing="12" visible="false" managed="false"
                  StackPane.alignment="TOP_RIGHT" prefWidth="320" maxWidth="320" maxHeight="360">
                <StackPane.margin>
                    <Insets top="70" right="20" bottom="0" left="0"/>
                </StackPane.margin>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="Notificaciones" styleClass="panel-title" HBox.hgrow="ALWAYS"/>
                    <Button onAction="#cerrarPanelNotificaciones" styleClass="panel-close-button">
                        <graphic>
                            <Label text="✕" styleClass="panel-close-icon"/>
                        </graphic>
                    </Button>
                </HBox>
                <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" prefHeight="240" maxHeight="260">
                    <VBox fx:id="panelNotificacionesContent" spacing="12"/>
                </ScrollPane>
            </VBox>

            <VBox fx:id="panelPerfil" styleClass="profile-panel" spacing="16" visible="false" managed="false"
                  StackPane.alignment="TOP_RIGHT" prefWidth="260" maxWidth="260">
                <StackPane.margin>
                    <Insets top="70" right="20" bottom="0" left="0"/>
                </StackPane.margin>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label fx:id="lblPerfilNombre" text="Usuario" styleClass="panel-title"/>
                        <Label fx:id="lblPerfilCorreo" text="correo@municipal.go.cr" styleClass="panel-subtitle"/>
                    </VBox>
                    <Button onAction="#cerrarPanelPerfil" styleClass="panel-close-button">
                        <graphic>
                            <Label text="✕" styleClass="panel-close-icon"/>
                        </graphic>
                    </Button>
                </HBox>
                <Separator/>
                <Button text="Editar perfil" styleClass="panel-button" onAction="#editarPerfil"/>
                <Button text="Cerrar sesión" styleClass="panel-button-danger" onAction="#cerrarSesion"/>
            </VBox>
        </StackPane>
    </top>
    
    <!-- SIDEBAR -->
    <left>
        <VBox styleClass="sidebar" spacing="5" prefWidth="250">
            <padding>
                <Insets top="20" right="10" bottom="20" left="10"/>
            </padding>
            
            <Button fx:id="btnInicio" text="Inicio" styleClass="menu-item, active" 
                    onAction="#mostrarInicio" maxWidth="Infinity">
                <graphic>
                    <Label text="🏠" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnGestionEspacios" text="Gestión de espacios" styleClass="menu-item" 
                    onAction="#mostrarGestionEspacios" maxWidth="Infinity">
                <graphic>
                    <Label text="🏢" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnGestionUsuarios" text="Gestión de usuarios" styleClass="menu-item" 
                    onAction="#mostrarGestionUsuarios" maxWidth="Infinity">
                <graphic>
                    <Label text="👥" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnControlReservas" text="Control de reservas" styleClass="menu-item" 
                    onAction="#mostrarControlReservas" maxWidth="Infinity">
                <graphic>
                    <Label text="📅" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnReportesGlobales" text="Reportes globales" styleClass="menu-item" 
                    onAction="#mostrarReportesGlobales" maxWidth="Infinity">
                <graphic>
                    <Label text="📊" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnMonitoreoClimatico" text="Monitoreo climático" styleClass="menu-item" 
                    onAction="#mostrarMonitoreoClimatico" maxWidth="Infinity">
                <graphic>
                    <Label text="☁️" styleClass="menu-icon"/>
                </graphic>
            </Button>
            
            <Button fx:id="btnConfiguracion" text="Configuración general" styleClass="menu-item" 
                    onAction="#mostrarConfiguracion" maxWidth="Infinity">
                <graphic>
                    <Label text="⚙️" styleClass="menu-icon"/>
                </graphic>
            </Button>
        </VBox>
    </left>
    
    <!-- CONTENIDO PRINCIPAL -->
    <center>
        <StackPane fx:id="contenedorPrincipal" styleClass="main-content">
            
            <!-- ============ INICIO / DASHBOARD ============ -->
            <ScrollPane fx:id="vistaInicio" fitToWidth="true" styleClass="content-section">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título de la sección -->
                    <VBox spacing="5">
                        <Label text="Panel de Administración" styleClass="section-title"/>
                        <Label text="Resumen general del sistema de reservas" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Cards superiores -->
                    <GridPane hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>
                        
                        <!-- Card: Espacios Activos -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="0">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Espacios Activos" styleClass="card-title" HBox.hgrow="ALWAYS"/>
                                <Label text="🏢" styleClass="card-icon-green"/>
                            </HBox>
                            <Label fx:id="lblEspaciosActivos" text="--" styleClass="card-value"/>
                            <Label text="Espacios disponibles para reserva" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Card: Reservas Hoy -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="1">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Reservas Hoy" styleClass="card-title" HBox.hgrow="ALWAYS"/>
                                <Label text="📅" styleClass="card-icon-blue"/>
                            </HBox>
                            <Label fx:id="lblReservasHoy" text="--" styleClass="card-value"/>
                            <Label text="Reservas programadas para hoy" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Card: Inasistencias -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="2">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Inasistencias" styleClass="card-title" HBox.hgrow="ALWAYS"/>
                                <Label text="👥" styleClass="card-icon-red"/>
                            </HBox>
                            <Label fx:id="lblInasistencias" text="--" styleClass="card-value"/>
                            <Label text="Total de inasistencias registradas" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Card: Ocupación Semanal -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="3">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Ocupación Semanal" styleClass="card-title" HBox.hgrow="ALWAYS"/>
                                <Label text="📈" styleClass="card-icon-green"/>
                            </HBox>
                            <Label fx:id="lblOcupacionSemanal" text="--" styleClass="card-value"/>
                            <HBox alignment="CENTER_LEFT" spacing="5">
                                <Label text="Promedio de ocupación" styleClass="card-description"/>
                                <Label fx:id="lblVariacionOcupacion" text="--"
                                       styleClass="card-change-positive"/>
                            </HBox>
                        </VBox>
                    </GridPane>
                    
                    <!-- Sección inferior -->
                    <GridPane hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>
                        
                        <!-- Clima actual -->
                        <VBox styleClass="info-card" GridPane.columnIndex="0">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            
                            <Label text="Clima actual" styleClass="section-subtitle-bold"/>
                            
                            <HBox alignment="CENTER" spacing="20">
                                <padding>
                                    <Insets top="20" bottom="20"/>
                                </padding>
                                <Label text="☀️" styleClass="weather-icon"/>
                                <VBox alignment="CENTER_LEFT">
                                    <Label fx:id="lblTemperatura" text="--" styleClass="weather-temp"/>
                                    <Label fx:id="lblClimaCondicion" text="--" styleClass="weather-condition"/>
                                </VBox>
                            </HBox>
                            
                            <HBox alignment="CENTER_LEFT" spacing="30">
                                <HBox spacing="10">
                                    <Label text="💨" styleClass="weather-detail-icon"/>
                                    <Label text="Viento:" styleClass="weather-detail-label"/>
                                    <Label fx:id="lblViento" text="--" styleClass="weather-detail-value"/>
                                </HBox>
                                <HBox spacing="10">
                                    <Label text="💧" styleClass="weather-detail-icon"/>
                                    <Label text="Lluvia:" styleClass="weather-detail-label"/>
                                    <Label fx:id="lblLluvia" text="--" styleClass="weather-detail-value"/>
                                </HBox>
                            </HBox>
                            
                            <Label text="" styleClass="weather-recommendation"/>
                        </VBox>
                        
                        <!-- Alertas Rápidas -->
                        <VBox styleClass="info-card" GridPane.columnIndex="1">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Alertas Rápidas" styleClass="section-subtitle-bold" HBox.hgrow="ALWAYS"/>
                                <Label fx:id="lblNumAlertas" text="0" styleClass="alert-badge"/>
                            </HBox>
                            <Label text="Notificaciones que requieren atención" styleClass="section-description"/>
                            
                            <VBox fx:id="contenedorAlertas" spacing="10">
                                <padding>
                                    <Insets top="15"/>
                                </padding>
                            </VBox>
                        </VBox>
                    </GridPane>
                </VBox>
            </ScrollPane>
            
            <!-- ============ GESTIÓN DE ESPACIOS ============ -->
            <ScrollPane fx:id="vistaGestionEspacios" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título y botón -->
                    <HBox alignment="CENTER_LEFT">
                        <VBox HBox.hgrow="ALWAYS">
                            <Label text="Gestión de Espacios" styleClass="section-title"/>
                            <Label text="Administra todos los espacios disponibles" styleClass="section-subtitle"/>
                        </VBox>
                        <Button text="Agregar Espacio" styleClass="btn-primary" onAction="#agregarEspacio">
                            <graphic>
                                <Label text="+" styleClass="icon"/>
                            </graphic>
                        </Button>
                    </HBox>
                    
                    <!-- Filtros -->
                    <VBox styleClass="filter-card" spacing="15">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <Label text="Filtros" styleClass="filter-title"/>
                        <Label text="Busca y filtra espacios por diferentes criterios" styleClass="filter-subtitle"/>
                        
                        <HBox spacing="15">
                            <TextField fx:id="txtBuscarEspacio" promptText="Buscar por nombre..." 
                                       styleClass="search-field" HBox.hgrow="ALWAYS"/>
                            <ComboBox fx:id="cmbTipoEspacio" promptText="Todos los tipos" 
                                      styleClass="filter-combo" prefWidth="200"/>
                            <ComboBox fx:id="cmbEstadoEspacio" promptText="Todos los estados" 
                                      styleClass="filter-combo" prefWidth="200"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de espacios -->
                    <VBox styleClass="table-card">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Espacios" styleClass="table-title" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Lista completa de espacios registrados" styleClass="table-subtitle"/>
                        
                        <TableView fx:id="tablaEspacios" styleClass="data-table">
                            <padding>
                                <Insets top="15"/>
                            </padding>
                            <columns>
                                <TableColumn fx:id="colNombreEspacio" text="Nombre" prefWidth="300"/>
                                <TableColumn fx:id="colTipoEspacio" text="Tipo" prefWidth="150"/>
                                <TableColumn fx:id="colCapacidadEspacio" text="Capacidad" prefWidth="150"/>
                                <TableColumn fx:id="colEstadoEspacio" text="Estado" prefWidth="150"/>
                                <TableColumn fx:id="colAccionesEspacio" text="Acciones" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </ScrollPane>
            
            <!-- ============ GESTIÓN DE USUARIOS ============ -->
            <ScrollPane fx:id="vistaGestionUsuarios" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título y botón -->
                    <HBox alignment="CENTER_LEFT">
                        <VBox HBox.hgrow="ALWAYS">
                            <Label text="Gestión de Usuarios" styleClass="section-title"/>
                            <Label text="Administra roles y accesos de usuarios" styleClass="section-subtitle"/>
                        </VBox>
                        <Button text="Agregar Usuario" styleClass="btn-primary" onAction="#agregarUsuario">
                            <graphic>
                                <Label text="👤+" styleClass="icon"/>
                            </graphic>
                        </Button>
                    </HBox>
                    
                    <!-- Filtros -->
                    <VBox styleClass="filter-card" spacing="15">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <Label text="Filtros" styleClass="filter-title"/>
                        <Label text="Busca y filtra usuarios por diferentes criterios" styleClass="filter-subtitle"/>
                        
                        <HBox spacing="15">
                            <TextField fx:id="txtBuscarUsuario" promptText="Buscar por nombre o correo..." 
                                       styleClass="search-field" HBox.hgrow="ALWAYS"/>
                            <ComboBox fx:id="cmbRolUsuario" promptText="Todos los roles" 
                                      styleClass="filter-combo" prefWidth="200"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de usuarios -->
                    <VBox styleClass="table-card">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Usuarios" styleClass="table-title" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Lista completa de usuarios registrados" styleClass="table-subtitle"/>
                        
                        <TableView fx:id="tablaUsuarios" styleClass="data-table">
                            <padding>
                                <Insets top="15"/>
                            </padding>
                            <columns>
                                <TableColumn fx:id="colUsuario" text="Usuario" prefWidth="220"/>
                                <TableColumn fx:id="colCorreo" text="Correo" prefWidth="280"/>
                                <TableColumn fx:id="colRol" text="Rol" prefWidth="220"/>
                                <TableColumn fx:id="colEstadoUsuario" text="Estado" prefWidth="120"/>
                                <TableColumn fx:id="colUltimoAcceso" text="Último acceso" prefWidth="180"/>
                                <TableColumn fx:id="colReservasUsuario" text="Reservas" prefWidth="160"/>
                                <TableColumn fx:id="colAccionesUsuario" text="Acciones"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </ScrollPane>
            
            <!-- ============ CONTROL DE RESERVAS ============ -->
            <ScrollPane fx:id="vistaControlReservas" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título y botón -->
                    <VBox spacing="5">
                        <Label text="Control de Reservas" styleClass="section-title"/>
                        <Label text="Visualiza y gestiona todas las reservas del sistema" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Filtros -->
                    <VBox styleClass="filter-card" spacing="15">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <Label text="Filtros" styleClass="filter-title"/>
                        <Label text="Busca y filtra reservas por diferentes criterios" styleClass="filter-subtitle"/>
                        
                        <HBox spacing="15">
                            <TextField fx:id="txtBuscarReserva" promptText="Buscar por espacio, usuario o evento..." 
                                       styleClass="search-field" HBox.hgrow="ALWAYS"/>
                            <ComboBox fx:id="cmbEstadoReserva" promptText="Todos los estados" 
                                      styleClass="filter-combo" prefWidth="200"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de reservas -->
                    <VBox styleClass="table-card">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Reservas" styleClass="table-title" HBox.hgrow="ALWAYS"/>
                        </HBox>
                        <Label text="Lista completa de reservas registradas" styleClass="table-subtitle"/>
                        
                        <TableView fx:id="tablaReservas" styleClass="data-table">
                            <padding>
                                <Insets top="15"/>
                            </padding>
                            <columns>
                                <TableColumn fx:id="colIdReserva" text="ID" prefWidth="50"/>
                                <TableColumn fx:id="colUsuarioReserva" text="Usuario" prefWidth="150"/>
                                <TableColumn fx:id="colEspacioReserva" text="Espacio" prefWidth="200"/>
                                <TableColumn fx:id="colFechaReserva" text="Fecha" prefWidth="120"/>
                                <TableColumn fx:id="colHoraReserva" text="Hora" prefWidth="120"/>
                                <TableColumn fx:id="colEstadoReservaTabla" text="Estado" prefWidth="120"/>
                                <TableColumn fx:id="colQRReserva" text="QR" prefWidth="100"/>
                                <TableColumn fx:id="colClimaReserva" text="Clima" prefWidth="100"/>
                                <TableColumn fx:id="colAccionesReserva" text="Acciones" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </ScrollPane>
            
            <!-- ============ REPORTES GLOBALES ============ -->
            <ScrollPane fx:id="vistaReportesGlobales" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título y botones -->
                    <HBox alignment="CENTER_LEFT">
                        <VBox HBox.hgrow="ALWAYS">
                            <Label text="Reportes Globales" styleClass="section-title"/>
                            <Label text="Análisis estadístico del uso de instalaciones" styleClass="section-subtitle"/>
                        </VBox>
                        <HBox spacing="10">
                            <Button text="Exportar Excel" styleClass="btn-secondary" onAction="#exportarExcel">
                                <graphic>
                                    <Label text="📊" styleClass="icon"/>
                                </graphic>
                            </Button>
                            <Button text="Exportar PDF" styleClass="btn-secondary" onAction="#exportarPDF">
                                <graphic>
                                    <Label text="📄" styleClass="icon"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </HBox>
                    
                    <!-- Selector de rango de fechas -->
                    <VBox styleClass="filter-card" spacing="15">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <Label text="Rango de fechas" styleClass="filter-title"/>
                        <Label text="Selecciona el período para generar el reporte" styleClass="filter-subtitle"/>
                        
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Label text="📅" styleClass="icon"/>
                            <ComboBox fx:id="cmbRangoFechas" value="Último mes" 
                                      styleClass="filter-combo" prefWidth="300"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Métricas principales -->
                    <GridPane hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>
                        
                        <!-- Reservas Activas -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="0">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Reservas Activas" styleClass="card-title"/>
                            <Label fx:id="lblReservasActivas" text="--" styleClass="card-value-large"/>
                            <Label text="En curso actualmente" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Reservas Completadas -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="1">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Reservas Completadas" styleClass="card-title"/>
                            <Label fx:id="lblReservasCompletadas" text="--" styleClass="card-value-large"/>
                            <Label text="Total finalizadas" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Tasa de Asistencia -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="2">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Tasa de Asistencia" styleClass="card-title"/>
                            <Label fx:id="lblTasaAsistencia" text="--" styleClass="card-value-large"/>
                            <Label fx:id="lblVariacionAsistencia" text="--"
                                   styleClass="card-change-positive"/>
                        </VBox>
                        
                        <!-- Inasistencias -->
                        <VBox styleClass="stat-card, card-alert" GridPane.columnIndex="3">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Inasistencias" styleClass="card-title"/>
                            <Label fx:id="lblInasistenciasReporte" text="--" styleClass="card-value-large"/>
                            <Label text="Requiere seguimiento" styleClass="card-warning"/>
                        </VBox>
                    </GridPane>
                    
                    <!-- Gráficos -->
                    <GridPane hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>
                        
                        <!-- Distribución por tipo -->
                        <VBox styleClass="chart-card" GridPane.columnIndex="0">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Distribución por Tipo de Espacio" styleClass="chart-title"/>
                            <Label text="Porcentaje de reservas por tipo de instalación" styleClass="chart-subtitle"/>
                            <StackPane fx:id="graficoDistribucion" styleClass="chart-container" 
                                       prefHeight="300" VBox.vgrow="ALWAYS">
                                <Label text="[Gráfico de distribución]" styleClass="chart-placeholder"/>
                            </StackPane>
                        </VBox>
                        
                        <!-- Espacios más utilizados -->
                        <VBox styleClass="chart-card" GridPane.columnIndex="1">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Espacios Más Utilizados" styleClass="chart-title"/>
                            <Label text="Ranking de espacios por cantidad de reservas" styleClass="chart-subtitle"/>
                            <StackPane fx:id="graficoRanking" styleClass="chart-container" 
                                       prefHeight="300" VBox.vgrow="ALWAYS">
                                <Label text="[Gráfico de barras]" styleClass="chart-placeholder"/>
                            </StackPane>
                        </VBox>
                    </GridPane>
                </VBox>
            </ScrollPane>
            
            <!-- ============ MONITOREO CLIMÁTICO ============ -->
            <ScrollPane fx:id="vistaMonitoreoClimatico" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título y botón -->
                    <VBox spacing="5">
                        <Label text="Monitoreo Climático" styleClass="section-title"/>
                        <Label text="Vista global del clima y alertas automáticas" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Alerta meteorológica -->
                    <HBox styleClass="weather-alert" spacing="15" alignment="CENTER_LEFT">
                        <padding>
                            <Insets top="15" right="20" bottom="15" left="20"/>
                        </padding>
                        <Label text="⚠️" styleClass="alert-icon-large"/>
                        <VBox HBox.hgrow="ALWAYS">
                            <Label text="Alertas meteorológicas activas" styleClass="alert-main-title"/>
                            <Label fx:id="lblMensajeAlertaMeteo" text=""
                                   styleClass="alert-main-message" wrapText="true"/>
                        </VBox>
                    </HBox>
                    
                    <!-- Resumen de monitoreo -->
                    <GridPane hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.34"/>
                        </columnConstraints>
                        
                        <!-- Espacios Monitoreados -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="0">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Espacios Monitoreados" styleClass="card-title"/>
                            <Label fx:id="lblEspaciosMonitoreados" text="--" styleClass="card-value-large"/>
                            <Label text="Espacios exteriores" styleClass="card-description"/>
                        </VBox>
                        
                        <!-- Alertas Activas -->
                        <VBox styleClass="stat-card, card-warning" GridPane.columnIndex="1">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Alertas Activas" styleClass="card-title"/>
                            <Label fx:id="lblAlertasActivas" text="--" styleClass="card-value-large"/>
                            <Label text="Requieren atención inmediata" styleClass="card-warning"/>
                        </VBox>
                        
                        <!-- Reservas Afectadas -->
                        <VBox styleClass="stat-card" GridPane.columnIndex="2">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <Label text="Reservas Afectadas" styleClass="card-title"/>
                            <Label fx:id="lblReservasAfectadas" text="--" styleClass="card-value-large"/>
                            <Label text="Total de reservas en riesgo" styleClass="card-description"/>
                        </VBox>
                    </GridPane>
                    
                    <!-- Tarjetas de clima por espacio -->
                    <GridPane fx:id="contenedorTarjetasClima" hgap="20" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.34"/>
                        </columnConstraints>
                    </GridPane>
                </VBox>
            </ScrollPane>
            
            <!-- ============ CONFIGURACIÓN GENERAL ============ -->
            <ScrollPane fx:id="vistaConfiguracion" fitToWidth="true" styleClass="content-section" visible="false">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Título -->
                    <VBox>
                        <Label text="Configuración del Sistema" styleClass="section-title"/>
                        <Label text="Gestiona las configuraciones y políticas del sistema de reservas" styleClass="section-subtitle"/>
                    </VBox>
                    
                    <!-- Tabs de configuración -->
                    <TabPane fx:id="tabsConfiguracion" styleClass="config-tabs" tabClosingPolicy="UNAVAILABLE">
                        
                        <!-- Tab: APIs -->
                        <Tab text="APIs">
                            <graphic>
                                <Label text="🔌" styleClass="tab-icon"/>
                            </graphic>
                            <VBox spacing="20">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <VBox styleClass="config-card" spacing="15">
                                    <padding>
                                        <Insets top="20" right="20" bottom="20" left="20"/>
                                    </padding>
                                    
                                    <HBox alignment="CENTER_LEFT" spacing="10">
                                        <Label text="☁️" styleClass="config-icon"/>
                                        <Label text="Integración de APIs Externas" styleClass="config-section-title" HBox.hgrow="ALWAYS"/>
                                    </HBox>
                                    <Label text="Configura las claves de API para servicios externos como clima y notificaciones" 
                                           styleClass="config-description" wrapText="true"/>
                                    
                                    <VBox spacing="15">
                                        <padding>
                                            <Insets top="15"/>
                                        </padding>
                                        
                                        <!-- API de Clima -->
                                        <VBox spacing="8">
                                            <Label text="API de Clima (OpenWeatherMap)" styleClass="config-label"/>
                                            <PasswordField fx:id="txtAPIClima" promptText="Ingresa tu clave API" 
                                                          styleClass="config-input"/>
                                            <HBox spacing="5" alignment="CENTER_LEFT">
                                                <Label text="Obtén tu clave en" styleClass="config-hint"/>
                                                <Hyperlink text="openweathermap.org" styleClass="config-link" 
                                                          onAction="#abrirLinkOpenWeather"/>
                                            </HBox>
                                        </VBox>
                                        
                                        <!-- API de Email -->
                                        <VBox spacing="8">
                                            <Label text="API de Email (SendGrid)" styleClass="config-label"/>
                                            <TextField fx:id="txtAPISendGrid" promptText="Ingresa tu clave API de SendGrid" 
                                                      styleClass="config-input"/>
                                            <Label text="Configura SendGrid para enviar notificaciones por correo" 
                                                   styleClass="config-hint"/>
                                        </VBox>
                                        
                                        <!-- API de SMS -->
                                        <VBox spacing="8">
                                            <Label text="API de SMS (Twilio)" styleClass="config-label"/>
                                            <TextField fx:id="txtAPITwilio" promptText="Ingresa tu clave API de Twilio" 
                                                      styleClass="config-input"/>
                                            <Label text="Opcional: Para notificaciones por SMS" styleClass="config-hint"/>
                                        </VBox>
                                    </VBox>
                                    
                                    <HBox spacing="10" alignment="CENTER_LEFT">
                                        <padding>
                                            <Insets top="10"/>
                                        </padding>
                                        <Button text="Guardar Configuración de APIs" styleClass="btn-primary" 
                                                onAction="#guardarConfiguracionAPIs"/>
                                        <Button text="Probar Conexiones" styleClass="btn-secondary" 
                                                onAction="#probarConexiones"/>
                                    </HBox>
                                </VBox>
                            </VBox>
                        </Tab>
                        
                        <!-- Tab: Notificaciones -->
                        <Tab text="Notificaciones">
                            <graphic>
                                <Label text="🔔" styleClass="tab-icon"/>
                            </graphic>
                            <VBox spacing="20">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <VBox styleClass="config-card" spacing="15">
                                    <padding>
                                        <Insets top="20" right="20" bottom="20" left="20"/>
                                    </padding>
                                    
                                    <Label text="Preferencias de Notificaciones" styleClass="config-section-title"/>
                                    <Label text="Configura cómo y cuándo se envían las notificaciones" 
                                           styleClass="config-description" wrapText="true"/>
                                    
                                    <VBox spacing="15">
                                        <padding>
                                            <Insets top="15"/>
                                        </padding>
                                        
                                        <CheckBox fx:id="chkNotifReservaConfirmada" text="Enviar notificación al confirmar reserva" 
                                                 styleClass="config-checkbox" selected="true"/>
                                        <CheckBox fx:id="chkNotifRecordatorioReserva" text="Enviar recordatorio 24h antes de la reserva" 
                                                 styleClass="config-checkbox" selected="true"/>
                                        <CheckBox fx:id="chkNotifAlertaClimatica" text="Enviar alerta en caso de mal clima" 
                                                 styleClass="config-checkbox" selected="true"/>
                                        <CheckBox fx:id="chkNotifCancelacion" text="Notificar cancelaciones" 
                                                 styleClass="config-checkbox" selected="true"/>
                                    </VBox>
                                    
                                    <Button text="Guardar Preferencias" styleClass="btn-primary" 
                                            onAction="#guardarPreferenciasNotificaciones"/>
                                </VBox>
                            </VBox>
                        </Tab>
                        
                        <!-- Tab: Políticas -->
                        <Tab text="Políticas">
                            <graphic>
                                <Label text="📋" styleClass="tab-icon"/>
                            </graphic>
                            <VBox spacing="20">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <VBox styleClass="config-card" spacing="15">
                                    <padding>
                                        <Insets top="20" right="20" bottom="20" left="20"/>
                                    </padding>
                                    
                                    <Label text="Políticas de Reserva" styleClass="config-section-title"/>
                                    <Label text="Define las reglas y restricciones del sistema de reservas" 
                                           styleClass="config-description" wrapText="true"/>
                                    
                                    <VBox spacing="15">
                                        <padding>
                                            <Insets top="15"/>
                                        </padding>
                                        
                                        <HBox spacing="15" alignment="CENTER_LEFT">
                                            <Label text="Tiempo máximo de reserva (horas):" styleClass="config-label" prefWidth="250"/>
                                            <Spinner fx:id="spinMaxHorasReserva" min="1" max="24" initialValue="4" 
                                                    editable="true" prefWidth="100" styleClass="config-spinner"/>
                                        </HBox>
                                        
                                        <HBox spacing="15" alignment="CENTER_LEFT">
                                            <Label text="Días anticipación mínima:" styleClass="config-label" prefWidth="250"/>
                                            <Spinner fx:id="spinDiasAnticipacion" min="0" max="30" initialValue="1" 
                                                    editable="true" prefWidth="100" styleClass="config-spinner"/>
                                        </HBox>
                                        
                                        <HBox spacing="15" alignment="CENTER_LEFT">
                                            <Label text="Máximo reservas simultáneas:" styleClass="config-label" prefWidth="250"/>
                                            <Spinner fx:id="spinMaxReservasSimultaneas" min="1" max="10" initialValue="3" 
                                                    editable="true" prefWidth="100" styleClass="config-spinner"/>
                                        </HBox>
                                        
                                        <CheckBox fx:id="chkPermitirCancelacion" text="Permitir cancelación de reservas" 
                                                 styleClass="config-checkbox" selected="true"/>
                                        <CheckBox fx:id="chkRequiereAprobacion" text="Las reservas requieren aprobación administrativa" 
                                                 styleClass="config-checkbox"/>
                                    </VBox>
                                    
                                    <Button text="Guardar Políticas" styleClass="btn-primary" 
                                            onAction="#guardarPoliticas"/>
                                </VBox>
                            </VBox>
                        </Tab>
                        
                        <!-- Tab: Seguridad -->
                        <Tab text="Seguridad">
                            <graphic>
                                <Label text="🔒" styleClass="tab-icon"/>
                            </graphic>
                            <VBox spacing="20">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                
                                <VBox styleClass="config-card" spacing="15">
                                    <padding>
                                        <Insets top="20" right="20" bottom="20" left="20"/>
                                    </padding>
                                    
                                    <Label text="Configuración de Seguridad" styleClass="config-section-title"/>
                                    <Label text="Ajusta los parámetros de seguridad del sistema" 
                                           styleClass="config-description" wrapText="true"/>
                                    
                                    <VBox spacing="15">
                                        <padding>
                                            <Insets top="15"/>
                                        </padding>
                                        
                                        <CheckBox fx:id="chkRequiere2FA" text="Requerir autenticación de dos factores (2FA)" 
                                                 styleClass="config-checkbox"/>
                                        <CheckBox fx:id="chkSesionExpirar" text="Expirar sesión después de inactividad" 
                                                 styleClass="config-checkbox" selected="true"/>
                                        <CheckBox fx:id="chkLogActividad" text="Registrar log de actividad de usuarios" 
                                                 styleClass="config-checkbox" selected="true"/>
                                    </VBox>
                                    
                                    <Button text="Guardar Configuración de Seguridad" styleClass="btn-primary" 
                                            onAction="#guardarConfiguracionSeguridad"/>
                                </VBox>
                            </VBox>
                        </Tab>
                    </TabPane>
                </VBox>
            </ScrollPane>
            
        </StackPane>
    </center>
    
</BorderPane>
